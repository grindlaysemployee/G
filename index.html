<!DOCTYPE html>
<html>
<head>
  <title>Grindtech Employee Portal</title>
  <style>
    body {
      font-family: Arial;
      background-color: #f2f2f2;
      margin: 0;
      padding: 40px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    h2 {
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    #profile {
      display: none;
    }
    .error {
      color: red;
      text-align: center;
    }
    .profile-field {
      margin: 5px 0;
    }
    .profile-field strong {
      display: inline-block;
      width: 180px;
    }
  </style>
</head>
<body>

<div class="container" id="login">
  <h2>Employee Login</h2>
  <input type="text" id="empId" placeholder="Employee ID" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <p class="error" id="errorMsg"></p>
</div>

<div class="container" id="profile">
  <h2>Welcome, <span id="name"></span></h2>
  <div class="profile-field"><strong>Emp ID:</strong> <span id="empIdProfile"></span></div>
  <div class="profile-field"><strong>Emp Code:</strong> <span id="empCode"></span></div>
  <div class="profile-field"><strong>Designation:</strong> <span id="designation"></span></div>
  <div class="profile-field"><strong>Father's Name:</strong> <span id="fatherName"></span></div>
  <div class="profile-field"><strong>Gender:</strong> <span id="gender"></span></div>
  <div class="profile-field"><strong>ESIC Number:</strong> <span id="esicNumber"></span></div>
  <div class="profile-field"><strong>PF Number:</strong> <span id="pfNumber"></span></div>
  <div class="profile-field"><strong>Date of Birth:</strong> <span id="dob"></span></div>
  <div class="profile-field"><strong>Mobile Number:</strong> <span id="mobile"></span></div>
  <div class="profile-field"><strong>Aadhar Number:</strong> <span id="aadhar"></span></div>
  <div class="profile-field"><strong>ID Proof:</strong> <span id="idProof"></span></div>
  <div class="profile-field"><strong>Permanent Address:</strong> <span id="permanentAddress"></span></div>
  <div class="profile-field"><strong>Local Address:</strong> <span id="localAddress"></span></div>
  <div class="profile-field"><strong>Date of Joining:</strong> <span id="joiningDate"></span></div>
  <div class="profile-field"><strong>Emergency Contact:</strong> <span id="emergencyContact"></span></div>
  <div class="profile-field"><strong>Status:</strong> <span id="status"></span></div>
</div>

<script>
  async function login() {
    const empId = document.getElementById("empId").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorMsg = document.getElementById("errorMsg");
    errorMsg.textContent = "";

    if (!empId || !password) {
      errorMsg.textContent = "Please enter both Employee ID and Password.";
      return;
    }

    const url = "https://script.google.com/macros/s/AKfycbzwxQPojqkdeSHmIXyO4dCABlREXYkL2B51ZKP1K5MNNpTDvanNCPHAT2OluD35lbqS/exec";

    const formData = new FormData();
    formData.append("empId", empId);
    formData.append("password", password);

    try {
      const res = await fetch(url, {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      if (data.success) {
        document.getElementById("login").style.display = "none";
        document.getElementById("profile").style.display = "block";

        // Format ISO date to dd-MMM-yy
        function formatDate(isoStr) {
          if (!isoStr) return "";
          const date = new Date(isoStr);
          const day = String(date.getDate()).padStart(2, '0');
          const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
          const month = monthNames[date.getMonth()];
          const year = String(date.getFullYear()).slice(-2);
          return `${day}-${month}-${year}`;
        }

        // Fill profile fields
        document.getElementById("name").textContent = data.name;
        document.getElementById("empIdProfile").textContent = data.empId;
        document.getElementById("empCode").textContent = data.empCode;
        document.getElementById("designation").textContent = data.designation;
        document.getElementById("fatherName").textContent = data.fatherName;
        document.getElementById("gender").textContent = data.gender;
        document.getElementById("esicNumber").textContent = data.esicNumber;
        document.getElementById("pfNumber").textContent = data.pfNumber;
        document.getElementById("dob").textContent = formatDate(data.dob);
        document.getElementById("mobile").textContent = data.mobile;
        document.getElementById("aadhar").textContent = data.aadhar;
        document.getElementById("idProof").textContent = data.idProof;
        document.getElementById("permanentAddress").textContent = data.permanentAddress;
        document.getElementById("localAddress").textContent = data.localAddress;
        document.getElementById("joiningDate").textContent = formatDate(data.joiningDate);
        document.getElementById("emergencyContact").textContent = data.emergencyContact;
        document.getElementById("status").textContent = data.status;

      } else {
        errorMsg.textContent = data.message || "Invalid credentials.";
      }
    } catch (error) {
      errorMsg.textContent = "Login failed. Please try again.";
    }
  }
</script>

</body>
</html>
